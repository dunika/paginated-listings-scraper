parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"n9i2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("debug"),t=r(e);function r(e){return e&&e.__esModule?e:{default:e}}exports.default=(0,t.default)("paginated-listings-scraper");
},{}],"kDm6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.extractListingData=exports.buildExtractData=void 0;var e=require("babel-runtime/helpers/objectWithoutProperties"),t=y(e),r=require("babel-runtime/helpers/extends"),n=y(r),u=require("babel-runtime/core-js/object/entries"),a=y(u),l=require("babel-runtime/helpers/asyncToGenerator"),i=y(l),o=require("lodash/pickBy"),d=y(o),s=require("lodash/isFunction"),c=y(s),f=require("url"),h=require("bluebird"),p=y(h),x=require("cheerio"),m=y(x),g=require("./debug"),b=y(g);function y(e){return e&&e.__esModule?e:{default:e}}const $=function(e,t,r,n){if((0,c.default)(e))return e({$:t,depth:n,url:r});const u=t(e);if(!u)return(0,b.default)(`getNextPageUrl - no element found for nextPageSelector ${e}`),null;const a=u.attr("href");if(!a)return null;try{const e=new f.URL(a).href;return(0,b.default)(`getNextPageUrl - returned ${r}`),e}catch(e){const{origin:t}=new f.URL(r);return`${t}${a}`}},q=e=>({$:t,parent:r})=>{return(r?r.find(e):t(e)).text().trim()},P=exports.buildExtractData=(e=>(()=>{var t=(0,i.default)(function*({parent:t,html:r,url:u}){try{const o=yield p.default.reduce((0,a.default)(e),(l=(0,i.default)(function*(e,[a,l]){const i=(0,c.default)(l)?l:q(l),o=m.default.load(r);try{const r=yield i({$:o,parent:t,url:u});return(0,n.default)({},e,{[a]:r})}catch(e){throw new Error(`${a} ${e.message}`)}}),function(e,t){return l.apply(this,arguments)}),{});return(0,d.default)(o)}catch(e){throw(0,b.default)(`Extraction error - ${e.message}`),new Error(`Extraction error: ${u}\n      ${e.message}\n    `)}var l});return function(e){return t.apply(this,arguments)}})()),v=(e,t)=>{const r={hasFinished:!1,hasPrinted:!1};return(()=>{var n=(0,i.default)(function*({html:n,parent:u,url:a}){const l=m.default.load(n);return r.hasFinished=t(u,l),r.hasFinished?(r.hasPrinted||((0,b.default)("extractData - terminated"),r.hasPrinted=!0),null):yield e({html:n,parent:u,url:a})});return function(e){return n.apply(this,arguments)}})()},w=e=>r=>{let{html:u}=r,a=(0,t.default)(r,["html"]);const l=m.default.load(u);return e((0,n.default)({$:l},a))},E=exports.extractListingData=(()=>{var e=(0,i.default)(function*({dataSelector:e,depth:t,filter:r,html:n,nextPageSelector:u,nextRequestOptions:a,parentSelector:l,terminate:o,url:d}){const s=m.default.load(n),f=s(l).filter(r||function(){return!0});if(!f.length)return(0,b.default)(`No elements found matching ${l}`),{data:null,nextPageUrl:$(u,s,d,t),nextRequestOptions:a&&a(s,d,t)};const h=(0,c.default)(e)?w(e):P(e),x=o?v(h,o):h,g=f.map(function(e,t){return s(t)}).get(),y=yield p.default.map(g,(q=(0,i.default)(function*(e){return yield x({html:n,parent:e,url:d})}),function(e){return q.apply(this,arguments)})).filter(Boolean);var q;return{data:y,nextPageUrl:y.length===f.length?$(u,s,d):null,nextRequestOptions:a&&a(d,s,t)}});return function(t){return e.apply(this,arguments)}})();
},{"./debug":"n9i2"}],"Tuxv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPage=void 0;var e=require("babel-runtime/helpers/extends"),r=c(e),t=require("babel-runtime/helpers/objectWithoutProperties"),o=c(t),u=require("babel-runtime/helpers/asyncToGenerator"),l=c(u),s=require("request-promise-native"),i=c(s),n=require("cheerio"),a=c(n),d=require("./extract-data");function c(e){return e&&e.__esModule?e:{default:e}}const f=(()=>{var e=(0,l.default)(function*(e,t={}){let{loadCheerio:u}=t,l=(0,o.default)(t,["loadCheerio"]);try{const{body:t,request:{uri:{href:o}}}=yield(0,i.default)((0,r.default)({resolveWithFullResponse:!0,uri:e},l));if(u){return{$:a.default.load(t),html:t,resolvedUrl:o}}return{html:t,resolvedUrl:o}}catch(r){throw new Error(`Request error: ${e}\n      ${r.message}\n    `)}});return function(r){return e.apply(this,arguments)}})();exports.getPage=f,exports.default=(()=>{var e=(0,l.default)(function*({url:e,selectors:t,requestOptions:o}){const{html:u,resolvedUrl:l,$:s}=yield f(e,(0,r.default)({},o,{loadCheerio:!0}));if(!u)throw new Error(`No HTML found: ${l}`);const i=(0,d.buildExtractData)(t);return yield i({$:s,html:u,selectors:t,url:l})});return function(r){return e.apply(this,arguments)}})();
},{"./extract-data":"kDm6"}],"SGVh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("babel-runtime/helpers/extends"),r=c(e),t=require("babel-runtime/helpers/asyncToGenerator"),u=c(t),a=require("babel-runtime/helpers/objectWithoutProperties"),n=c(a),i=require("lodash/fp/isFunction"),l=c(i),o=require("lodash/fp/isNumber"),d=c(o),s=require("./scrape-page"),f=require("./extract-data"),h=require("./debug"),p=c(h);function c(e){return e&&e.__esModule?e:{default:e}}function m(e){let{maximumDepth:t,url:a,shouldReturnDataOnError:i=!1,terminate:o}=e,h=(0,n.default)(e,["maximumDepth","url","shouldReturnDataOnError","terminate"]);if(!(0,d.default)(t)&&!(0,l.default)(o))throw Error("Please provide either a maximumDepth or a a terminate function");const c=(m=(0,u.default)(function*(e,u,{depth:n=1}={}){if((0,d.default)(t)&&n>t)return(0,p.default)(`Maximum depth reached: ${n}`),[];(0,p.default)(`Current page depth: ${n}`);try{const{html:t}=yield(0,s.getPage)(e,u),{requestOptions:l,nextPageUrl:d,data:m}=yield(0,f.extractListingData)((0,r.default)({depth:n,html:t,terminate:o,url:a},h));if(d||l){const e=yield c(d,l,{depth:n+1});return[...m&&m,...e]}return m}catch(e){if((0,p.default)(`Error: ${e.message}`),i)return[];throw new Error(e)}}),function(e,r){return m.apply(this,arguments)});var m;return c}exports.default=(()=>{var e=(0,u.default)(function*(e){try{const{url:t,requestOptions:u}=e,a=(0,n.default)(e,["url","requestOptions"]),i=t||u.url,l=yield m((0,r.default)({requestUrl:i},a))(i,u);return l?(0,p.default)(`Finished with ${l.length} results`):(0,p.default)("No data found"),l}catch(e){throw(0,p.default)(`Error: ${e.message}`),new Error(e)}});return function(r){return e.apply(this,arguments)}})();
},{"./scrape-page":"Tuxv","./extract-data":"kDm6","./debug":"n9i2"}],"Focm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getPage=exports.scrapePage=void 0;var e=require("./scrape-listing"),r=s(e),t=require("./scrape-page"),a=s(t);function s(e){return e&&e.__esModule?e:{default:e}}exports.default=r.default,exports.scrapePage=a.default,exports.getPage=t.getPage;
},{"./scrape-listing":"SGVh","./scrape-page":"Tuxv"}]},{},["Focm"], null)
//# sourceMappingURL=/index.map